image: juampynr/drupal8ci:latest
pipelines:
  default:
    - parallel:
        # - step:
        #     name: Coding Standards
        #     script:
        #       - robo job:build
        #       - vendor/bin/robo job:coding-standards
        # - step:
        #     name: Unit test
        #     services:
        #       - mariadb
        #     script:
        #       - sleep 10
        #       - robo job:build
        #       - vendor/bin/robo job:unit-tests
        # - step:
        #     name: Code coverage
        #     services:
        #       - mariadb
        #     script:
        #       - sleep 10
        #       - robo job:build
        #       - vendor/bin/robo job:coverage-report
        - step:
            name: Behat
            services:
              - mariadb
            script:
              - sleep 10
              - robo job:build
              - vendor/bin/robo job:serve-drupal
              - vendor/bin/robo job:behat-tests
            variables:
              DB_DUMP_URL: "https://raw.githubusercontent.com/fjgarlin/d9-lagoon/9.x/assets/d9-lagoon-dump.sql"

definitions:
  services:
    mariadb:
      image: mariadb:latest
      variables:
        MYSQL_ROOT_PASSWORD: root
